<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>æ—©é¤é¸æ“‡</title>
        <link rel="stylesheet" href="style.css" />
        <style>
          body {
            margin: 0;
            height: 100vh;
            background: linear-gradient(-45deg, #e8c2ae, #f3d8c7, #fef7f0, #f4dece);
            background-size: 400% 400%;
            animation: gradientBG 10s ease infinite;
            font-family: Arial, sans-serif;
          }
    
          @keyframes gradientBG {
            0% {
              background-position: 0% 50%;
            }
            50% {
              background-position: 100% 50%;
            }
            100% {
              background-position: 0% 50%;
            }
          }
    
          .floating-icons {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
          }
    
          .floating-icon {
            position: absolute;
            font-size: 4rem;
            animation: float 8s linear infinite;
            top: 80%; /* æ”¹è®Šä½ç½®ï¼Œä½¿å…¶åˆå§‹ä½ç½®ä½æ–¼è¼ƒä½è™• */
          }

        @keyframes float {
            0% {
            transform: translateY(0);
            }
            50% {
            transform: translateY(-30vh); /* æ”¹è®Šå‹•ç•«çš„çµæŸé»ï¼Œè®“åœ–æ¨™å¾è¦–çª—ä¸­æ¶ˆå¤± */
            }
            100% {
            transform: translateY(0); /* é‡æ–°å›åˆ°åŸä½ç½®ï¼Œå½¢æˆå¾ªç’° */
            }
          }
    
    
          .placeholder {
            display: inline-block;
            margin: 10px;
          }
    
          .stage {
            text-align: center;
          }
    
          button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #f6a46a;
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
          }
    
          button:hover {
            background-color: #b3764a;
          }
        </style>
    </head>
<body>
    <div class="nav-container">
        <button class="nav-button" onclick="NavMenu()">â˜°</button>
        <div id="nav-menu" class="nav-menu">
            <a href="./index.html">å›ä¸»é </a>
            <a href="./history.html">æ­·å²ç´€éŒ„</a>
            <a href="./breakfast.html">Breakfast</a>
            <a href="./lunch.html">Lunch</a>
            <a href="./dinner.html">Dinner</a>
            <a href="./contact.html">è¯çµ¡æˆ‘å€‘</a>
        </div>
    </div>

    <div id="progress-bar-container">
      <div id="progress-bar"></div>
    </div>

    <br>
    <br>
    <h1>æ—©é¤æ‹‰éœ¸</h1>
    <br><br><br>
    <h2>é¤é»é¡åˆ¥</h2>
    <br>
    <div>
        <label><input type="checkbox" id="main" value="main"> ä¸»é¤</label>
        <label><input type="checkbox" id="snack" value="snack"> é»å¿ƒ</label>
        <label><input type="checkbox" id="drink" value="drink"> é£²æ–™</label>
        <br>
    </div>

    <div id="placeholders" class="stage">
        <!-- é¤é»é¡¯ç¤ºå€åŸŸ -->
    </div>

    <button onclick="RandomChoices()">éš¨ä¾¿å•¦!</button>
    <button id="eat-button" style="display:none;" onclick="SaveToHistory()">åƒï¼</button>

    <div id="page-loader" class="loader" style="display: none;"></div>
    <div id="page-loader-overlay" style="display: none;"></div>

    <!-- æ¼‚æµ®åœ–æ¨™ -->
    <div class="floating-icons">
        <span class="floating-icon" style="left: 10%; animation-delay: 0s;">ğŸ•</span>
        <span class="floating-icon" style="left: 30%; animation-delay: 2s;">ğŸ£</span>
        <span class="floating-icon" style="left: 50%; animation-delay: 4s;">ğŸ©</span>
        <span class="floating-icon" style="left: 70%; animation-delay: 1s;">ğŸ¥—</span>
        <span class="floating-icon" style="left: 90%; animation-delay: 3s;">ğŸ”</span>
    </div>

    <script>
        let selectedItems = []; // å„²å­˜ç•¶å‰ç”Ÿæˆçš„é¤é»
        let rollingIntervals = []; // ç”¨æ–¼å­˜æ”¾ setInterval çš„ id
        let totalCalories = 0; // ç´€éŒ„ç¸½ç†±é‡
        let totalCarbs = 0; // ç´€éŒ„ç¸½ç¢³æ°´åŒ–åˆç‰©

        function NavMenu() {
            const navMenu = document.getElementById("nav-menu");
            navMenu.style.display =
                navMenu.style.display === "none" || navMenu.style.display === ""
                    ? "flex"
                    : "none";
        }

        function RandomChoices() {
            const placeholders = document.getElementById("placeholders");
            placeholders.innerHTML = "";
            selectedItems = [];
            totalCalories = 0;
            totalCarbs = 0;

            rollingIntervals.forEach(clearInterval); // æ¸…é™¤æ‰€æœ‰æ»¾å‹•å‹•ç•«
            rollingIntervals = [];

            const randomButton = document.querySelector('button[onclick="RandomChoices()"]');
            randomButton.disabled = true; // ç¦ç”¨æŒ‰éˆ•

            document.getElementById("eat-button").style.display = "none"; //åˆå§‹éš±è—

            const selectedTypes = [];
            if (document.getElementById("main").checked) selectedTypes.push("main");
            if (document.getElementById("snack").checked) selectedTypes.push("snack");
            if (document.getElementById("drink").checked) selectedTypes.push("drink");

            if (selectedTypes.length === 0) {
                alert("ä¸åƒé€²ä¾†å¹¹å˜›ï¼");
                randomButton.disabled = false;
                return;
            }

            fetch("./breakfast.json")
                .then((response) => response.json())
                .then((data) => {
                    let startDelay = 0;

                    selectedTypes.forEach((type, index) => {
                        setTimeout(() => {
                            const items = data[type];
                            const randomItemIndex = Math.floor(Math.random() * items.length);

                            const itemDiv = document.createElement("div");
                            itemDiv.className = "placeholder";
                            itemDiv.style.textAlign = "center";

                            const img = document.createElement("img");
                            img.style.width = "150px";
                            img.style.height = "150px";
                            itemDiv.appendChild(img);

                            const description = document.createElement("p");
                            itemDiv.appendChild(description);

                            placeholders.appendChild(itemDiv);

                            let currentIndex = 0;
                            const intervalId = setInterval(() => {
                                const currentItem = items[currentIndex];
                                img.src = currentItem.image;
                                img.alt = currentItem.name;
                                description.textContent = currentItem.name;
                                currentIndex = (currentIndex + 1) % items.length;
                            }, 100);

                            rollingIntervals.push(intervalId);

                            setTimeout(() => {
                                clearInterval(intervalId);
                                const finalItem = items[randomItemIndex];
                                img.src = finalItem.image;
                                img.alt = finalItem.name;
                                description.textContent = finalItem.name;

                                selectedItems.push({
                                    name: finalItem.name,
                                    image: finalItem.image,
                                    calories: finalItem.calories,
                                    carbs: finalItem.carbs
                                });

                                totalCalories += finalItem.calories;
                                totalCarbs += finalItem.carbs;

                                // åªæœ‰åœ–ç‰‡è¼‰å…¥å¾Œï¼Œæ‰é¡¯ç¤ºç‡Ÿé¤Šæ¨™ç¤º
                                img.onload = () => {
                                    const nutritionCard = document.createElement("div");
                                    nutritionCard.className = "nutrition-card";

                                    const title = document.createElement("h3");
                                    title.textContent = "ç‡Ÿé¤Šè³‡è¨Š";
                                    nutritionCard.appendChild(title);

                                    const list = document.createElement("ul");
                                    list.innerHTML = `
                                        <li>ç†±é‡: ${finalItem.calories} å¤§å¡</li>
                                        <li>è›‹ç™½è³ª: ${finalItem.protein} å…‹</li>
                                        <li>ç¢³æ°´: ${finalItem.carbs} å…‹</li>
                                    `;
                                    nutritionCard.appendChild(list);

                                    itemDiv.appendChild(nutritionCard);
                                };
                            }, 3000);
                        }, startDelay); // å»¶é²

                        startDelay += 1000; // 1 ç§’
                    });

                    setTimeout(() => {
                        randomButton.disabled = false;

                        // åœ¨æ‰€æœ‰é¤é»éƒ½é¸æ“‡å®Œç•¢å¾Œæ‰é€²è¡Œä¸€æ¬¡ç¸½çš„è­¦å‘Šæª¢æŸ¥
                        if (totalCalories > 700) {
                            alert("è­¦å‘Š: ç†±é‡è¶…é 700 å¤§å¡ï¼Œè«‹æ³¨æ„é£²é£Ÿå¹³è¡¡ï¼");
                        }
                        if (totalCarbs > 90) {
                            alert("è­¦å‘Š: ç¢³æ°´åŒ–åˆç‰©å«é‡è¶…é 90 å…‹ï¼Œè«‹æ³¨æ„é£²é£Ÿå¹³è¡¡ï¼");
                        }

                        document.getElementById("eat-button").style.display = "block";
                    }, 3600 + (selectedTypes.length - 1) * 1000);
                })
                .catch((error) => {
                    console.error("Error loading JSON:", error);
                    randomButton.disabled = false;
                });
        }




        function SaveToHistory() {
            const history = JSON.parse(localStorage.getItem("history")) || [];
            history.push({
                time: new Date().toLocaleString(),
                category: "Breakfast",
                items: selectedItems,
                totalCalories: totalCalories,
                totalCarbs: totalCarbs
            });
            localStorage.setItem("history", JSON.stringify(history));

            alert("å®Œæˆç´€éŒ„ï¼å¯ä»¥åˆ°æ­·å²ç´€éŒ„æŸ¥çœ‹ã€‚");
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeNavLinks();
        });

        function initializeNavLinks() {
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetUrl = link.href;
                    showLoader(() => {
                        window.location.href = targetUrl;
                    });
                });
            });
        }

        function showLoader(callback) {
            const loader = document.getElementById('page-loader');
            const overlay = document.createElement('div');
            overlay.id = 'page-loader-overlay';
            document.body.appendChild(overlay);

            loader.style.display = 'block';
            overlay.style.display = 'block';

            setTimeout(() => {
                callback();
            }, 1500);
        }
    </script>
</body>
</html>
